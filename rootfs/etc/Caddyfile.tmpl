{{/* HealthCheck  */}}
{{ .HealthzHost }}:{{ .HealthzPort }} {
  status 200 {{ .HealthzPath }}
}

{{ range $indexServer, $server:= .Servers }}
  {{ $host := $server.Hostname | cleanHostname }}
  {{ if ne $host "" }}
    {{ $host }} {
      log stdout
      tls {$ACME_EMAIL}
      # tls self_signed
      # tls off

      {{ range $indexLocation, $location := $server.Locations }}
        {{ if not $location.IsDefBackend }}
          {{ if $location.Service }}
            {{ $spec := $location.Service.Spec }}

            # {{ $location.Backend }}
            proxy {{ $location.Path }} {{ $spec | fromSpec }} {
              transparent
              {{ if ne $location.Path "/" }}
                without {{ $location.Path }}
              {{ end }}
            }
          {{ end }}
        {{ end }}
      {{ end }}
    }
  {{ end }}
{{ end }}
